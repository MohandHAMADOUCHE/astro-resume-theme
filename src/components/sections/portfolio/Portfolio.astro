---
import Project from '../Project.astro';
import { projects } from '../../../config/cv.json';
import { localizeProjects, splitHeadTail } from '../../../utils/localize';
import type { Locale } from '../../../i18n/ui';
import { t } from '../../../i18n/ui';
import previewImg from '../../../assets/images/mohand_hamadouche.png';

interface Props { locale?: Locale }
const { locale = 'fr' } = Astro.props as Props;
const localized = localizeProjects(projects as any, locale as any);
const { head: firstRow, tail: remainder } = splitHeadTail(localized, 3);
const previewUrl = import.meta.env.PUBLIC_BARI91_PREVIEW_URL || 'https://github.com/MohandHAMADOUCHE/bari91-company-website';
---

<section class="bg-background">
    <div class="container px-6 py-14 mx-auto">
        <h1 class="text-3xl font-semibold text-center capitalize lg:text-4xl">
            {t(locale, 'portfolioTitle', 'My portfolio')}
        </h1>

        <p class="mt-4 text-center text-offset">
            {t(locale, 'portfolioSubtitle')}
        </p>

        <!-- LARGE: keep previous behaviour (3 on top, remainder centered) -->
        <div class="portfolio-large">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 mt-8 lg:mt-12">
                {firstRow.map((project: any) => (
                    <div>
                        <Project
                            imageUrl={project.imageUrl}
                            title={project.title}
                            type={project.type}
                            link={project.link}
                            description={project.description}
                        />
                    </div>
                ))}
            </div>

            {remainder.length > 0 && (
                <div class="flex justify-center gap-8 mt-8">
                    {remainder.map((project: any) => (
                        <div class="w-full sm:w-1/2 md:w-1/3 max-w-lg">
                            <Project
                                imageUrl={project.imageUrl}
                                title={project.title}
                                type={project.type}
                                link={project.link}
                                description={project.description}
                            />
                        </div>
                    ))}
                </div>
            )}
        </div>

        <!-- SMALL: for screens <1200px show 2-per-row responsive list -->
        <div class="portfolio-small">
            <div class="portfolio-list flex flex-wrap justify-center gap-8 mt-8 lg:mt-12">
                {localized.map((project: any) => (
                    <div class="portfolio-item">
                        <Project
                            imageUrl={project.imageUrl}
                            title={project.title}
                            type={project.type}
                            link={project.link}
                            description={project.description}
                        />
                    </div>
                ))}
            </div>
        </div>

        <!-- Additional Live Preview row -->
        <div class="mt-16">
            <h2 class="text-2xl font-semibold text-center">{t(locale, 'livePreview', 'Live previews')}</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 mt-8">
                <div>
                    <Project
                        imageUrl={previewImg}
                        title={t(locale, 'bari91Title', 'Bari91 â€” Company Website')}
                        type={t(locale, 'website', 'Website')}
                        link={previewUrl}
                        description={t(locale, 'bari91Desc', 'Live preview of the Bari91 company website')}
                    />
                </div>
            </div>
        </div>

        <style>
        /* default: small version shown, large hidden */
        .portfolio-large { display: none; }
        .portfolio-small { display: block; }

        /* small layout: 1 column mobile, 2 columns from 640px */
        .portfolio-item { width: 100%; max-width: 100%; }

        /* make small layout visually full-bleed: expand the small container to viewport width
           by offsetting it outside the centered `.container`. Desktop/large layout remains untouched. */
        .portfolio-small {
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            padding-left: 1.5rem; /* inner padding to match container spacing */
            padding-right: 1.5rem;
            box-sizing: border-box;
        }

        .portfolio-list { /* keep flex behaviour */ }
        .portfolio-item { padding-left: 0; padding-right: 0; box-sizing: border-box; }

        @media (min-width: 640px) {
            /* at tablet and up keep normal centered container spacing */
            .portfolio-small { width: auto; left: auto; right: auto; margin-left: 0; margin-right: 0; padding-left: 0; padding-right: 0; }
            .portfolio-list { margin-left: 0; margin-right: 0; }
            .portfolio-item { padding-left: 0; padding-right: 0; width: 48%; max-width: 48%; }
        }

        /* iPad-mini / small tablet: between 640px and 900px, show single centered card matching Education width */
        @media (min-width: 640px) and (max-width: 1024px) {
            .portfolio-list { justify-content: center; }
            .portfolio-item { width: 100%; max-width: 720px; }
        }

        /* at >=1200px switch to the large layout (3 on top + remainder centered) */
        @media (min-width: 1200px) {
            .portfolio-large { display: block; }
            .portfolio-small { display: none; }
        }
        </style>
    </div>
</section>
