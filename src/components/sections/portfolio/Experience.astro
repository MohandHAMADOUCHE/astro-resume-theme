---
import CardListSection from "./CardListSection.astro";
import cv, { experiences } from '../../../config/cv.json';
// Inline lightweight localizer to avoid module resolution issues
import type { Locale } from '../../../i18n/ui';
import { t } from '../../../i18n/ui';

interface Props { locale?: Locale; showDetails?: boolean }
const props = Astro.props as Props;
const locale: Locale = props?.locale ?? 'fr';
// read default visibility from cv.json display.experience.showDetails[locale]
const cfg: any = (cv as any)?.display?.experience?.showDetails ?? {};
const defaultShow: boolean = typeof cfg?.[locale] === 'boolean' ? !!cfg[locale] : true;
const showDetails: boolean = typeof props?.showDetails === 'boolean' ? !!props.showDetails : defaultShow;
const localizeList = (list: any, loc: string, keys: any) => ((globalThis.Array?.isArray(list)) ? list : []).map((item: any) => {
	const out: any = { ...item };
	const K: any = keys as any;
	const L = (K && typeof K.length === 'number') ? K.length : 0;
	for (let i = 0; i < L; i++) { const k = K[i]; out[k] = loc === 'en' ? (item?.[`${k}_en`] ?? item?.[k]) : item?.[k]; }
	return out;
});
const items = localizeList(experiences as any, locale as any, ['title','sub_title','details']);
---
<CardListSection title={t(locale, 'experience', 'Experience')} items={items} showDetails={showDetails} />

<!-- Callout panel at the bottom of the Experience section -->
<div class="mt-12 flex w-full justify-center">
	<div class="relative w-full max-w-3xl rounded-2xl p-[1px] bg-gradient-to-br from-fuchsia-600/40 via-cyan-500/40 to-amber-500/40">
		<div class="rounded-2xl bg-neutral-900/80 px-6 py-8 text-center ring-1 ring-white/10 backdrop-blur">
			<p class="text-2xl font-semibold tracking-tight text-white">
				{t(locale, 'experienceCalloutTitle', 'Want to know more?')}
			</p>
			<p class="mt-2 text-sm text-white/70">
				{t(locale, 'experienceCalloutJoke', 'I reply faster than my coffee machine warms up â˜•')}
			</p>
			<a href="/contact" class="mt-5 inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-fuchsia-600 to-cyan-500 px-5 py-2.5 font-medium text-white shadow-lg shadow-fuchsia-500/25 focus:outline-none focus:ring-2 focus:ring-fuchsia-400 focus:ring-offset-2 focus:ring-offset-neutral-900">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
					<path d="M1.5 8.67v8.58a2.25 2.25 0 0 0 2.25 2.25h16.5a2.25 2.25 0 0 0 2.25-2.25V8.67l-8.59 5.16a3.75 3.75 0 0 1-3.82 0L1.5 8.67Z" />
					<path d="M22.5 6.908V6.75A2.25 2.25 0 0 0 20.25 4.5H3.75A2.25 2.25 0 0 0 1.5 6.75v.158l9.53 5.72a2.25 2.25 0 0 0 2.34 0l9.13-5.72Z" />
				</svg>
				<span>{t(locale, 'contactMe', 'Contact me')}</span>
			</a>
		</div>
	</div>
  
</div>
