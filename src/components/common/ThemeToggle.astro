---
import AnyIcon from './AnyIcon.astro';
---

<button id="toggle-theme-button"
    aria-label="Toggle theme"
    class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border bg-default
        text-default shadow-sm hover:bg-offset focus:outline-none focus:bg-offset">
    <div id="icon-theme-light" class="hidden">
    <AnyIcon name={'Sun'} />
    </div>
    <div id="icon-theme-dark" class="hidden">
    <AnyIcon name={'Moon'} />
    </div>
    <div id="icon-theme-retrowave" class="hidden">
    <AnyIcon name={'Retro'} />
    </div>
    <span class="sr-only" id="theme-next-label">Toggle theme</span>
    
</button>

<script is:inline>
    (function(){
            const button = document.getElementById('toggle-theme-button');
            const iconLight = document.getElementById('icon-theme-light');
            const iconDark = document.getElementById('icon-theme-dark');
            const iconRetro = document.getElementById('icon-theme-retrowave');

            const applyTheme = (theme) => {
                document.documentElement.dataset.theme = theme;
                if (iconLight && iconDark && iconRetro) {
                    iconLight.classList.add('hidden');
                    iconDark.classList.add('hidden');
                    iconRetro.classList.add('hidden');
                    if (theme === 'light') iconLight.classList.remove('hidden');
                    else if (theme === 'dark') iconDark.classList.remove('hidden');
                    else iconRetro.classList.remove('hidden');
                }
            };

            const cycle = ['light','dark','retrowave'];
            const getNextTheme = (cur) => cycle[(cycle.indexOf(cur) + 1) % cycle.length];

            const saved = localStorage.getItem('theme') || 'light';
            localStorage.setItem('theme', saved);
            applyTheme(saved);

            button?.addEventListener('click', () => {
                const current = document.documentElement.dataset.theme || 'light';
                const next = getNextTheme(current);
                localStorage.setItem('theme', next);
                applyTheme(next);
            });
        })();
    </script>
